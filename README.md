# Cost Calculation App Planning

## ゴール
- 小規模な原価計算ニーズに応じられる簡易アプリ
- 入力したコスト要素を合算し、製品単価・利益率まで可視化できる状態を目指す
- 実装は Next.js + Tailwind CSS + shadcn/ui を利用し、Vercel へデプロイする。
- 動作確認段階ではブラウザのみで完結させる想定で、DB もローカルホスト（例: SQLite/Postgres のローカルインスタンス）を利用する。
- アプリケーション構造はヘキサゴナルアーキテクチャ（Ports & Adapters）を採用し、UI・アプリケーションサービス・ドメインロジック・インフラ層を疎結合に保つ。

## 開発・運用スタック（暫定）
- **フロントエンド**: Next.js（App Router）+ Tailwind CSS + shadcn/ui。ブラウザのみで操作できる SPA/MPA ハイブリッド構成。
- **ホスティング/CI**: Vercel を利用し、main ブランチへの push で自動デプロイ。
- **データベース**: まずはローカルホスト上の DB（SQLite など）で動作検証。将来的に Vercel の環境変数を介してマネージド DB へ差し替え予定。
- **認証/権限**: 初期は未実装予定。必要になったら NextAuth などを検討。
- **その他**: すべてブラウザ経由で操作できるようにし、ネイティブアプリや専用クライアントは当面想定しない。
- **アーキテクチャ**: ヘキサゴナルアーキテクチャをベースに、ドメイン層・アプリケーションサービス層・UI 層・インフラ層をポート/アダプタで切り分け、将来的な DB や外部サービス差し替えを容易にする。

## ローカルでの動かし方
1. 依存関係をインストール: `npm install`
2. 開発サーバーを起動: `npm run dev`
3. ブラウザで `http://localhost:3000` を開き、マスタ登録 → 商品登録 → コスト入力 → サマリ確認のフローを試す。
4. 入力データは `localStorage` に保存される。リセットは画面上「すべてリセット」ボタンで可能。
5. デモデータを再投入したい場合は画面上部の「デモデータ投入」を押す。完全に空の状態から始めたい場合は「ローカル保存をクリア」で localStorage を初期化できる。

## データモデル（初期案）

### マスタ系テーブル
- **products**: `id`, `name`, `category_large`, `category_medium`, `category_small`, `registered_at`, `base_man_hours`, `default_electricity_cost`, `created_at`, `updated_at`。
- **product_categories_large**: `id`, `name`, `description`, `sort_order`, `created_at`, `updated_at`。
- **product_categories_medium**: `id`, `large_category_id`, `name`, `description`, `sort_order`, `created_at`, `updated_at`。
- **product_categories_small**: `id`, `medium_category_id`, `name`, `description`, `sort_order`, `created_at`, `updated_at`。
- **product_sizes**: `id`, `product_id`, `label`, `notes`, `created_at`, `updated_at`。
- **product_expected_productions**: `id`, `product_id`, `period_years`, `quantity`, `effective_from`, `effective_to`, `created_at`, `updated_at`（編集履歴を持たせるため時系列管理）。
- **product_options**: `id`, `product_id`, `name`, `additional_notes`, `created_at`, `updated_at`。
- **materials**: `id`, `name`, `unit`, `size_description`, `default_currency`, `supplier`, `notes`, `created_at`, `updated_at`。
- **material_stocks**: `id`, `material_id`, `supplier`, `lot_name`, `quantity_on_hand`, `unit_cost`, `location`, `note`, `created_at`, `updated_at`。
- **material_price_logs**: `id`, `material_id`, `purchase_date`, `purchase_place`, `purchase_price`, `lot_size`, `currency`, `exchange_rate`, `size_label`, `created_at`。
- **packaging_items**: `id`, `name`, `unit`, `size_description`, `default_currency`, `notes`, `created_at`, `updated_at`。
- **labor_roles**: `id`, `name`, `hourly_rate`, `currency`, `notes`, `created_at`, `updated_at`（時給レートマスタ）。
- **equipments**: `id`, `name`, `acquisition_cost`, `currency`, `amortization_years`, `notes`, `created_at`, `updated_at`。

### 商品別コスト入力テーブル
- **material_cost_entries**: `id`, `product_id`, `material_id`, `material_price_log_id`, `usage_ratio`, `usage_amount`, `unit`, `yield_rate`, `notes`, `created_at`, `updated_at`。
- **packaging_cost_entries**: `id`, `product_id`, `packaging_item_id`, `quantity_per_unit`, `unit_cost`, `currency`, `notes`, `created_at`, `updated_at`。
- **labor_cost_entries**: `id`, `product_id`, `labor_role_id`, `hours`, `people_count`, `hourly_rate_override`, `currency`, `created_at`, `updated_at`。
- **outsourcing_cost_entries**: `id`, `product_id`, `cost_per_unit`, `currency`, `notes`, `created_at`, `updated_at`。
- **development_costs**: `id`, `product_id`, `prototype_labor_cost`, `prototype_material_cost`, `tooling_cost`, `amortization_years`, `created_at`, `updated_at`。
- **equipment_allocations**: `id`, `product_id`, `equipment_id`, `allocation_ratio`, `annual_quantity`, `created_at`, `updated_at`。
- **logistics_cost_entries**: `id`, `product_id`, `shipping_method`, `cost_per_unit`, `currency`, `notes`, `created_at`, `updated_at`。
- **electricity_cost_entries**: `id`, `product_id`, `cost_per_unit`, `currency`, `created_at`, `updated_at`（商品登録時に入力）。

### 集計・履歴系（必要に応じて）
- **cost_snapshots**: `id`, `product_id`, `total_material`, `total_packaging`, `total_labor`, `total_outsourcing`, `total_development`, `total_equipment`, `total_logistics`, `total_electricity`, `unit_cost`, `selling_price`, `margin`, `captured_at`。
- **audit_logs**: 操作ログ（どのマスタ/カテゴリを誰がいつ更新したか）。初期は必須ではないがヘキサ構成でアダプタとして追加可能。

## ヘキサゴナル構成のポート/アダプタ境界（案）

### ドメイン層
- **Entities / Value Objects**: Product, ProductCategory, Material, PackagingItem, LaborRole, Equipment, CostEntries, ExpectedProduction など。
- **Domain Services**: 原価計算ロジック（ユニット原価算出、設備配賦計算、開発費償却）、残量率計算、利益率計算。

### アプリケーション層（Ports）
- **ProductCommandPort**: 商品の登録・更新・想定生産量変更。UI から呼び出され、ドメインサービスを介してリポジトリへ委譲。
- **MasterDataCommandPort**: 材料/梱包材/設備/時給/カテゴリの CRUD。
- **CostEntryCommandPort**: 各コストカテゴリの明細追加・更新・削除。
- **ProductQueryPort**: 商品詳細、原価サマリ、カテゴリ別明細、設備配分などの読取用ポート。
- **MasterDataQueryPort**: マスタ一覧取得（プルダウン用、在庫・価格履歴表示など）。
- **ReportingPort**: cost_snapshots 取得、利益率レポートなど。

### インフラ層（Adapters）
- **RepositoryAdapters**: Prisma など ORM 経由で DB へアクセス。各エンティティ/集計テーブルに対応したアダプタを用意。
- **SnapshotStorageAdapter**: cost_snapshots などの履歴保存。後でクラウドストレージへ差し替え可能。
- **Logging/AuditAdapter**: 操作ログ記録。初期はコンソール/DB へ、将来外部ロガーに差し替え。
- **ExchangeRateAdapter（将来）**: 為替レート取得が必要になった場合に外部 API と連携。

### UI 層（Adapters）
- **Next.js Pages / Server Actions**: フォーム送信やデータ取得でアプリケーション層のポートを呼び出す。
- **shadcn Components**: 入力フォーム・一覧表示などのプレゼンテーション担当。ドメインロジックには依存しない。

UI → Application Ports → Domain Services → Repository Adapters という流れを徹底し、副作用（DB 書き込みや外部 API 呼び出し）はアダプタに閉じ込める。

## 状態管理・フォーム処理方針（案）
- **Server Actions / Route Handlers**: 商品登録やマスタ CRUD、コスト明細登録など副作用を伴う操作は Server Actions または API route handler 経由で Application Port を呼ぶ。
- **React Query（TanStack Query）**: マスタ一覧や商品詳細、原価サマリなど読み取り系データは React Query でフェッチし、キャッシュ・再検証を統一的に扱う。
- **Zustand（ローカル UI 状態）**: 一時的なフォーム入力値やダイアログ開閉状態など、サーバーと無関係な UI 状態を軽量に管理。
- **フォームライブラリ**: React Hook Form + zod resolver を採用し、各フォームでバリデーションを共通化。zod スキーマはドメイン層の Value Object バリデーションとも共有可能にする。
- **エラーハンドリング**: アプリケーション層の例外を UI 側で toasts/alerts にマップし、React Query の error boundary で再利用。

## バリデーション・単位/通貨ルール（案）
- **zod スキーマ**: 各入力フォームの型と制約（必須/任意、範囲、フォーマット）を zod で定義し、アプリケーション層でも再利用して二重定義を防ぐ。
- **金額/数量フォーマット**: 金額は Decimal 型（Prisma Decimal など）で管理し、通貨コード（ISO 4217）を必須とする。数量は単位ごとに最小桁数/最大値を zod で制約。
- **単位管理**: materials / packaging_items に `unit` を持たせ、入力時は単位プルダウンから選択。単位変換が必要な場合はドメインサービスで対応。
- **通貨換算**: 初期は単一通貨でも良いが、将来の多通貨対応に備えて `currency` フィールドと `exchange_rate`（任意）を全コストエントリで保持。
- **日付/期間**: 想定生産量や購入日などの日付は ISO 8601 で保存。期間（年数）は整数or decimal で制約。
- **ユニーク制約/外部キー**: マスタ名・カテゴリ階層はユニーク制約を設け、リレーションは DB レベルで外部キーを設定してデータ整合性を担保。

## テスト戦略（案）
- **ユニットテスト**: ドメインサービス（原価計算、設備配賦、償却計算など）を中心に Vitest でカバレッジを確保。zod スキーマの境界値テストも含める。
- **Integration テスト**: Next.js Route Handler / Server Action を対象に、実際の Repository Adapter をモックした形でアプリケーション層の挙動を検証。
- **E2E テスト**: Playwright を使い、主要フロー（商品登録→カテゴリ入力→原価確認）をブラウザ操作で確認。Vercel Preview でも走らせる。
- **Snapshot データ検証**: cost_snapshots の計算結果は固定入力に対して期待値ファイルを持ち、リグレッション検知用のテストを用意。
- **CI 連携**: Vercel デプロイ前に GitHub Actions 等で lint/test を走らせ、失敗したらデプロイしない。

## アクセス制御（初期方針）
- **ロール**: 「閲覧のみ」「編集可」の 2 ロールを想定。閲覧のみは原価確認ページやレポートを閲覧でき、編集可はマスタ登録や商品登録、コスト入力が可能。
- **認証**: 初期リリースでは未実装。将来 NextAuth などでログインを追加できるように、アプリケーション層には Authorization ポリシーを注入できる設計にする。
- **認可チェック**: サーバー側のアプリケーションサービスでロール判定を行い、UI 層では権限に応じた表示制御を行う（編集ボタンの表示/非表示など）。
- **操作ログ**: 将来のアクセス制御強化に備えてアダプタで操作ログを記録可能にしておく（現時点では任意実装）。
## 原価計算で考慮したい主なコストカテゴリ
|カテゴリ|概要|必要になりそうな入力例|
|---|---|---|
|材料費|製品を構成する主要素材の調達コスト。為替や仕入れ単価の変動もありえる。|素材名、仕入先、単価、使用量、歩留まり率|
|外注費|協力会社やフリーランスへの委託費用。|商品 1 つあたりに掛かった外注費総額|
|梱包材費|箱、緩衝材、ラベルなど出荷に必要な資材。|登録済み梱包材マスタから選択し、アイテム別に使用数量を入力|
|人件費（製造・運用）|製造ラインや運用オペレーションにかかる作業コスト。|工数（時間）、時給、人数|
|開発コスト|試作段階で発生するコスト。|試作工数、試作用材料費、試作用道具費、償却年数|
|設備投資|機械・治具・ITインフラなどの購入や減価償却。|設備名、取得額、償却年数、想定年間生産数量|
|物流・配送費|保管、輸送、ラストワンマイル配送に関わるコスト。|配送方法、商品 1 つあたりの配送費用|
|間接費（電気代のみ）|製造やオフィス運営で消費する電力コストに限定。|商品 1 つあたりに載せたい電気代|

## 今後整理したいこと
- 現時点では全項目を任意入力とし、将来的にユースケース別テンプレートで必須化できる仕組みをどう設計するか
- 単価計算だけか、利益率・損益分岐点の算出まで踏み込むか
- 初期開発費や設備投資をどの期間で償却し、製品単価にどう載せるか
- ユーザーが一度入力した情報をどこまでテンプレ化・再利用できるか
- 画面構成（入力フォーム vs. ステップ式ウィザード）と、データの可視化方法

## 入力ルールの方針（暫定）
- すべてのコストカテゴリは任意入力。未入力の場合は 0 または「未計上」として扱う。
- 後からカテゴリ単位・項目単位で必須設定を切り替えられるよう、バリデーションや UI をテンプレート化しておく。
- 将来の必須条件変更に備え、計算ロジック側では「入力済み項目のみ合算」の方針を徹底する。
- カテゴリそのものやカテゴリ内の項目はユーザーが追加・名称変更・削除できる想定で、設定データを永続化しておく。

## 入力・計算フローのラフ案
0. 事前準備として、材料マスタ・梱包材マスタ・設備一覧・時給レート（人件費）などを登録しておく。
1. ユーザーはカテゴリ一覧から必要なものだけ選択し、順番に入力フォームを開く。
2. 商品登録フォーム内で材料・梱包・人件費・外注・開発・設備配賦・物流・電気などの原価要素をまとめて入力し、原価タブでは参照のみとする（再入力不要）。
3. 入力済み原価は「原価確認」タブでカテゴリごとにサマリ表示される。
4. すべての入力を終えたら「計算サマリ」テーブルで合計原価、1ユニットあたり原価、任意の販売価格に基づく利益率を算出。
5. 後からカテゴリや項目を編集できるよう、計算サマリは常に最新の入力データを反映。
5. 商品登録時に「想定生産量（何年で何個生産予定か）」を入力し、設備投資と開発コストの配賦計算で利用する。
6. 電気代など商品ごとの固定値があれば商品登録時に入力し、各計算フローでは登録済みの値を参照する（毎回手入力しない）。

各コストカテゴリは順番に入力を完了させる前提で、梱包材・設備・材料・時給などのマスタ情報は事前登録済みのものを選ぶだけで済む運用を想定している。

## 画面遷移イメージ（暫定）
- **梱包材マスタページ**: 登録・編集・削除、在庫/単価の管理。原価入力時はこのデータを参照。
- **材料マスタページ**: 素材ごとの価格履歴・在庫を管理。
- **設備ページ**: 設備登録、償却条件、年間生産数配分（商品ごとの利用割合もここで確認）。
- **時給レートページ**: 職種/工程ごとの時給を登録。人件費入力フォームから参照。
- **カテゴリマスタページ**: 大カテゴリ / 中カテゴリ / 小カテゴリを事前登録し、商品登録フォームでプルダウンから選択できるようにする。
- **原価確認ページ**: 商品別の原価サマリ。ページ内に商品登録フォーム（基本情報/想定生産量/設備利用設定・原価要素入力など）を配置し、登録内容を参照専用のタブで確認する。
- **カテゴリ入力ページ群**: 材料費、梱包材費、人件費など各カテゴリごとに独立した入力ページを用意し、マスタ参照しながら明細を追加。
- **在庫管理ページ**: 材料在庫（仕入先・ロケーション・在庫数量）を登録し、商品登録とサマリから参照できるようにする。
- **原価確認ページ**: 商品登録時に入力した値のみを表示する参照専用タブ。入力はすべて商品登録フォームで完結する。

## UI メモ（商品登録フォーム / 在庫管理）
- 「商品基本情報」「原価入力」という2つのセクションで構成し、同一フォーム内で材料・梱包・人件費・外注・開発・設備配賦・物流・電気代まで入力できるようにする。
- フォーム送信時に商品IDで紐づいたコストエントリがまとめて登録され、原価確認タブに即時反映される。原価確認タブは参照専用で、編集は商品登録フォーム側で実施。
- 設備の利用状況や想定生産量など、配賦計算に必要な情報も商品登録時に揃える前提とし、後続タブでは再入力させない。
- 在庫管理カードでは、材料マスタに紐づく在庫レコード（仕入先・ロケーション・在庫数量・単価）を登録し、商品登録とサマリから参照できるようにする。

## 現状の課題とTODO
- [x] 実装では商品登録とは別に「商品別原価入力」カードを用意しており、README で定義した「商品登録フォーム内で原価入力まで完了させる」設計と乖離している。フォーム構成を統合し、参照タブに入力要素を置かないよう改修する。
- [x] 材料マスタの仕様（仕入先、購入ロット、使用率/残量など）が UI に反映されていない。商品登録時にこれらを入力できるフィールドを追加する。
- [x] 設備利用・電気代など、商品登録で既に取得する情報が原価入力カードでも再入力になっている。商品登録時の情報をそのまま配賦計算に使用するようデータフローを整理する。
- [x] 商品登録フォームの材料セクションから「使用量」「単価」入力を削除し、材料マスタの単価＋使用率のみで計算する。
- [x] 梱包材はマスタ側で単価まで登録し、商品登録時は「梱包材選択＋数量」のみにする。
- [x] 開発コストほか数値入力で `0` がデフォルト表示される問題とスクロールによる値変化を解消する（数値専用入力コンポーネントに統一）。
- [x] 配送方法をマスタ登録し、商品登録画面では配送方法選択のみで単価はマスタ参照にする。
- [x] 材料マスタと在庫マスタの役割が重複しているので、ロケーション/ロットを扱わない前提であれば材料マスタへ集約する。
- [x] 商品登録のサイズ展開入力でカンマ等の文字列を自由に扱えるようにする。
- [x] 開発コスト明細にタイトルを追加し、用途別に複数項目を登録できるようにする。

## 材料費モジュール（第一弾）
- **目的**: 製品を構成する主要素材のコストを正確に積み上げる。歩留まりや為替差も考慮可能な器を用意。
- **入力項目（初期テンプレ案）**
  - 素材名（材料マスタから選択。未登録素材はその場で追加可能）
  - 購入日（YYYY-MM-DD、複数ロットを区別）
  - 購入場所/仕入先（店舗・EC・サプライヤー名など）※材料マスタで管理
  - 調達単価/購入価格（通貨込み）
  - サイズ/容量（購入時のサイズ表記、例: 50kg ロール）
  - 使用率（そのロットのうち製品 1 ユニットに使用する割合 %）
  - 実使用量（製品 1 ユニットあたり。使用率と紐づく）
  - 単位（kg、m、個など）
  - 歩留まり率またはロス率（任意）
  - 備考（仕入先メモ、為替レートなど）
- **計算ロジック（1 明細）**
  - `実質使用率 = 使用率 / 歩留まり率`
  - `残量率 = 100% - 実質使用率`
  - `実質使用量 = 実使用量 / 歩留まり率`（歩留まり率未入力なら実使用量をそのまま採用）
  - `材料費明細 = 調達単価 × 実質使用率`（単価がロット価格の場合）または `調達単価 × 実質使用量`（単価が単位当たりの場合）
- **モジュール合計**
  - 全明細を合算してカテゴリ合計材料費を算出。
  - 為替や単価の変動に備え、複数通貨を扱う場合は共通通貨へ換算するロジックをオプションで用意。
- **今後の拡張ポイント**
  - 明細テンプレをユーザーが複製・カスタムできるようにする。
  - 原価計算時に期間別（例: 月次、ロット別）の材料費実績を比較できるようにする。

### 追加で検討したい材料費データ
- **価格変動ログ**: 素材ごとの仕入れ単価と適用開始日を履歴管理し、原価の遡及計算やトレンド分析に使えるようにする。

### 在庫管理と材料使用量の連携
- **目的**: 材料在庫（仕入先・ロケーション・在庫数量）と商品ごとの消費量を同じ画面で把握し、補充やロット切替の判断に役立てる。
- **マスタ入力**: 材料マスタでは仕入先を必須項目として保持し、在庫マスタカードで材料・仕入先・ロケーション・在庫数量・単価を登録する。
- **商品登録**: 材料明細カードで使用率/使用量を入力すると、在庫参照カードにリアルタイムで反映される（1 個あたり使用量 + 在庫残量）。
- **サマリ**: 原価サマリタブに在庫サマリカードを追加し、材料ごとの在庫数量・累計使用量・仕入先を一覧表示。従来の材料費カードはこの在庫サマリ内に統合する。
- **将来拡張**: 期間別の在庫推移、発注点アラート、材料ロットの引当（FIFO/LIFO）などを追加予定。

まずは材料費モジュールのデータモデルと UI 遷移を固め、同じパターンを他カテゴリにも展開していく方針で進める想定です。材料マスタと入力画面の連携フローは後で詳細設計を詰める。

## 梱包材費モジュールの方針
- **梱包材マスタ**: 段ボール、プラケース、フィルム、緩衝材などを事前に登録しておくリスト。各アイテムには「名称」「サイズ/仕様」「単価」「単位（枚、m、セットなど）」「在庫/購入情報」を保持。
- **選択方式**: 商品 1 ユニットを作る際に必要な梱包材をマルチセレクトで選び、アイテムごとに使用数量を入力する。登録がない梱包材はその場でマスタに追加可能。
- **計算ロジック**: `梱包材費明細 = 登録単価 × 使用数量` をアイテムごとに算出し、カテゴリ合計として積み上げる。まとめ買い割引などがある場合はマスタ側に単価テーブルを持てるようにする。
- **残量管理**: 任意で在庫残量を持たせ、梱包材マスタと同期できるようにしておくと、使用数量入力時に警告を出せる。
- **UI イメージ**: リスト形式で梱包材を表示し、チェックボックス＋数量入力フィールドを並べる。数量 0 のアイテムは計算対象外。

## 開発コストの扱い
- **入力項目**: 試作工数（時間×時給などで金額化）、試作用材料費、試作用道具費、償却年数、対象商品の想定生産量（商品登録時に設定した値を参照）。
- **総開発コスト**: `試作工数コスト + 試作用材料費 + 試作用道具費`。
- **年次按分額**: `総開発コスト ÷ 償却年数`。年数未入力の場合は 1 年として扱う。
- **製品単価への載せ方**: 年次按分額を設備ごとの利用割合で按分し、設備単位での配賦額を算出してから、該当する商品へ分配する。サマリ表示も設備単位で集計する。
- **拡張余地**: フェーズ別（試作1号/量産前）に分ける、償却残期間の管理、途中での追加開発費の追加入力など。

- **設備投資の扱い**
  - **必要入力**: 取得額（税抜ベース推奨）、償却年数、想定年間生産数量（年間で何ユニット生産するか）。想定生産量は商品登録時の入力から自動で候補を表示する。
  - **年間償却額**: `取得額 ÷ 償却年数`。減価償却方法は定額法を基本とし、必要であれば今後カスタマイズ。
  - **設備ごとのユニットコスト**: `年間償却額 ÷ 年間想定生産数量` を基準単価とし、商品登録フォームで入力する「設備での作業時間（h）」を使って利用割合を算出。複数設備を使う場合でも、各設備の使用時間比率に応じて原価へ按分する。
  - **累積回収/導入判断**: 設備単位のカードに「累積配賦額」「回収率」「シミュレーション用入力（予定生産数・売価）」を表示し、導入前後の判断材料とする。
  - **拡張ポイント**: 設備稼働の実績時間から自動で利用率を算出したり、ロット単位での引当（FIFO/LIFO）を追加する。設備サマリは設備ベースで集計し、どの設備にいくら原価が乗っているかを一目で確認できるようにする。

## 想定生産量の扱い
- **入力タイミング**: 商品登録時に「期間（年数）」と「期間内の生産予定数量」を必ず入力する。例: 3 年で 30,000 個。
- **利用範囲（当面）**: 開発コストと設備投資の配賦計算にのみ使用し、その他カテゴリは将来の要件に応じて連動を検討。
- **設備別の見える化**: 各設備について「対象商品」「年間生産数量」「利用割合」を一覧できるビューを用意し、種類が増えると設備コスト/ユニットが逓減する様子を可視化。
- **将来拡張案**: 在庫計画や需要予測と連携して生産数量を自動更新したり、実績値との乖離を分析するレポートを追加。

## 商品登録時に決める項目
- **商品名**: 製品を識別する名称。SKU や管理 ID は必要に応じて別途保持。
- **カテゴリ階層**: 大カテゴリ / 中カテゴリ / 小カテゴリを3階層で設定。集計フィルタやレポート切替に利用。
- **想定生産量**: 期間（年数）と期間内の生産予定数量をセットで入力（例: 2 年で 10,000 個）。登録後も商品編集画面から更新でき、設備投資・開発コストの配賦に即時反映。
- **オプション一覧（名称＋個数）**: サイズやカスタムオプションを名称と数量で管理し、ロット内訳や在庫計画に利用。
- **設備利用設定**: 商品登録時に登録済み設備から複数選択し、各設備の利用割合/年間生産数量を紐づける。変更が必要になった場合は設備管理画面で再配分し、関連商品の配賦を再計算する。
- **1 個あたりの制作工数**: 基準サイズ・仕様で製造する際の工数（時間）。人件費モジュールの初期値として利用。
- **登録日**: 商品をシステムへ登録した日付。後続で履歴管理やソートに利用。
- **備考**: サイズ配分の理由や注意事項などを自由記述で保持。追加コストや在庫計画のメモにも利用。
- **商品別原価入力**: 商品登録フォーム内で以下の原価要素をまとめて入力し、原価タブでは参照のみとする。
  - 材料費（材料マスタから選択、仕入先/購入ロット、使用率や残量メモ、単価、通貨）
  - 梱包材費（梱包材選択、使用数量、単価）
  - 人件費（作業カテゴリ、工数、人数、任意の時給上書き）
  - 外注費（委託内容メモ、単価、通貨）
  - 開発コスト（試作工数コスト、試作用材料費、道具費、償却年数）
  - 設備配賦（設備マスタとの紐付け・利用割合、年間数量）
  - 物流・配送費（配送方法、単価、通貨）
  - 電気代（1ユニットあたりの電気代、通貨）
